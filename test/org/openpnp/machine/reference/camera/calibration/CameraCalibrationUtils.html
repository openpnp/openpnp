<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_322) on Wed Jan 19 17:11:56 UTC 2022 -->
<title>CameraCalibrationUtils</title>
<meta name="date" content="2022-01-19">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="CameraCalibrationUtils";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":9,"i2":9,"i3":9,"i4":9,"i5":9,"i6":9,"i7":9,"i8":9,"i9":9,"i10":9};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/AdvancedCalibration.html" title="class in org.openpnp.machine.reference.camera.calibration"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/LensCalibrationParams.html" title="class in org.openpnp.machine.reference.camera.calibration"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html" target="_top">Frames</a></li>
<li><a href="CameraCalibrationUtils.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.openpnp.machine.reference.camera.calibration</div>
<h2 title="Class CameraCalibrationUtils" class="title">Class CameraCalibrationUtils</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.openpnp.machine.reference.camera.calibration.CameraCalibrationUtils</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">CameraCalibrationUtils</span>
extends java.lang.Object</pre>
<div class="block">Provides a set of utilities to aid in camera calibration</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#FIX_ASPECT_RATIO">FIX_ASPECT_RATIO</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#FIX_DISTORTION_COEFFICENTS">FIX_DISTORTION_COEFFICENTS</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#FIX_PRINCIPAL_POINT">FIX_PRINCIPAL_POINT</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#FIX_ROTATION">FIX_ROTATION</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static double</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#sigmaThresholdForRejectingOutliers">sigmaThresholdForRejectingOutliers</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#CameraCalibrationUtils--">CameraCalibrationUtils</a></span>()</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>static double</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeBestCameraParameters-double:A:A:A-double:A:A:A-double:A:A:A-java.util.List-double:A-">computeBestCameraParameters</a></span>(double[][][]&nbsp;testPattern3dPoints,
                           double[][][]&nbsp;testPatternImagePoints,
                           double[][][]&nbsp;modeledImagePoints,
                           java.util.List&lt;java.lang.Integer&gt;&nbsp;outlierPointList,
                           double[]&nbsp;parameters)</code>
<div class="block">Computes the best, in a least squared error sense, set of camera parameters that transform 
 the given test pattern 3D coordinates to the corresponding 2D image points.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static double</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeBestCameraParameters-double:A:A:A-double:A:A:A-double:A:A:A-java.util.List-double:A-int-">computeBestCameraParameters</a></span>(double[][][]&nbsp;testPattern3dPoints,
                           double[][][]&nbsp;testPatternImagePoints,
                           double[][][]&nbsp;modeledImagePoints,
                           java.util.List&lt;java.lang.Integer&gt;&nbsp;outlierPointList,
                           double[]&nbsp;parameters,
                           int&nbsp;flags)</code>
<div class="block">Computes the best, in a least squared error sense, set of camera parameters that transform 
 the given test pattern 3D coordinates to the corresponding 2D image points.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>static double</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeDrmsError-java.util.List-">computeDrmsError</a></span>(java.util.List&lt;double[]&gt;&nbsp;residuals)</code>
<div class="block">Computes the Distance Root-Mean-Squared (DRMS) error for a given set of 2D errors</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>static Mat</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeRectificationMatrix-Mat-Mat-Mat-Mat-double-">computeRectificationMatrix</a></span>(Mat&nbsp;transformFromMachToPhyCamRefFrame,
                          Mat&nbsp;vectorFromMachToPhyCamInMachRefFrame,
                          Mat&nbsp;transformFromMachToVirCamRefFrame,
                          Mat&nbsp;vectorFromMachToVirCamInMachRefFrame,
                          double&nbsp;primaryZ)</code>
<div class="block">Computes the rectification matrix that converts normalized physical camera coordinates to the
 virtual camera coordinates</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>static java.util.List&lt;double[]&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeResidualErrors-double:A:A:A-double:A:A:A-">computeResidualErrors</a></span>(double[][][]&nbsp;actual2DPoints,
                     double[][][]&nbsp;modeled2DPoints)</code>
<div class="block">Computes the 2D error between the actual image points and the modeled image points</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>static java.util.List&lt;double[]&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeResidualErrors-double:A:A:A-double:A:A:A-java.util.ArrayList-">computeResidualErrors</a></span>(double[][][]&nbsp;actual2DPoints,
                     double[][][]&nbsp;modeled2DPoints,
                     java.util.ArrayList&lt;java.lang.Integer&gt;&nbsp;outlierList)</code>
<div class="block">Computes the 2D error between the actual image points and the modeled image points</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>static java.util.List&lt;double[]&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeResidualErrors-double:A:A:A-double:A:A:A-java.lang.Integer-">computeResidualErrors</a></span>(double[][][]&nbsp;actual2DPoints,
                     double[][][]&nbsp;modeled2DPoints,
                     java.lang.Integer&nbsp;heightIndex)</code>
<div class="block">Computes the 2D error between the actual image points and the modeled image points</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>static java.util.List&lt;double[]&gt;</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeResidualErrors-double:A:A:A-double:A:A:A-java.lang.Integer-java.util.ArrayList-">computeResidualErrors</a></span>(double[][][]&nbsp;actual2DPoints,
                     double[][][]&nbsp;modeled2DPoints,
                     java.lang.Integer&nbsp;heightIndex,
                     java.util.ArrayList&lt;java.lang.Integer&gt;&nbsp;outlierList)</code>
<div class="block">Computes the 2D error between the actual image points and the modeled image points</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>static Mat</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeVirtualCameraMatrix-Mat-Mat-Mat-Size-Size-double-boolean-">computeVirtualCameraMatrix</a></span>(Mat&nbsp;physicalCameraMatrix,
                          Mat&nbsp;distortionCoefficients,
                          Mat&nbsp;rectification,
                          Size&nbsp;phyCamSize,
                          Size&nbsp;virCamSize,
                          double&nbsp;alpha,
                          boolean&nbsp;keepPrincipalPoint)</code>
<div class="block">Computes the virtual camera matrix.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>static Mat</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#computeVirtualCameraMatrix-Mat-Mat-Mat-Size-Size-double-Mat-">computeVirtualCameraMatrix</a></span>(Mat&nbsp;physicalCameraMatrix,
                          Mat&nbsp;distortionCoefficients,
                          Mat&nbsp;rectification,
                          Size&nbsp;phyCamSize,
                          Size&nbsp;virCamSize,
                          double&nbsp;alpha,
                          Mat&nbsp;principalPoint)</code>
<div class="block">Computes the virtual camera matrix.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>static Mat</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html#generateErrorImage-Size-int-double:A:A:A-double:A:A:A-java.util.ArrayList-">generateErrorImage</a></span>(Size&nbsp;size,
                  int&nbsp;testPatternIndex,
                  double[][][]&nbsp;actual2DPoints,
                  double[][][]&nbsp;modeled2DPoints,
                  java.util.ArrayList&lt;java.lang.Integer&gt;&nbsp;outlierList)</code>
<div class="block">Generates a heat map of the residual errors between the actual image points and the modeled 
 image points.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="FIX_ASPECT_RATIO">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>FIX_ASPECT_RATIO</h4>
<pre>public static final&nbsp;int FIX_ASPECT_RATIO</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#org.openpnp.machine.reference.camera.calibration.CameraCalibrationUtils.FIX_ASPECT_RATIO">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="FIX_PRINCIPAL_POINT">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>FIX_PRINCIPAL_POINT</h4>
<pre>public static final&nbsp;int FIX_PRINCIPAL_POINT</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#org.openpnp.machine.reference.camera.calibration.CameraCalibrationUtils.FIX_PRINCIPAL_POINT">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="FIX_DISTORTION_COEFFICENTS">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>FIX_DISTORTION_COEFFICENTS</h4>
<pre>public static final&nbsp;int FIX_DISTORTION_COEFFICENTS</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#org.openpnp.machine.reference.camera.calibration.CameraCalibrationUtils.FIX_DISTORTION_COEFFICENTS">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="FIX_ROTATION">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>FIX_ROTATION</h4>
<pre>public static final&nbsp;int FIX_ROTATION</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#org.openpnp.machine.reference.camera.calibration.CameraCalibrationUtils.FIX_ROTATION">Constant Field Values</a></dd>
</dl>
</li>
</ul>
<a name="sigmaThresholdForRejectingOutliers">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>sigmaThresholdForRejectingOutliers</h4>
<pre>public static final&nbsp;double sigmaThresholdForRejectingOutliers</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../../../constant-values.html#org.openpnp.machine.reference.camera.calibration.CameraCalibrationUtils.sigmaThresholdForRejectingOutliers">Constant Field Values</a></dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="CameraCalibrationUtils--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>CameraCalibrationUtils</h4>
<pre>public&nbsp;CameraCalibrationUtils()</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="computeBestCameraParameters-double:A:A:A-double:A:A:A-double:A:A:A-java.util.List-double:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeBestCameraParameters</h4>
<pre>public static&nbsp;double&nbsp;computeBestCameraParameters(double[][][]&nbsp;testPattern3dPoints,
                                                 double[][][]&nbsp;testPatternImagePoints,
                                                 double[][][]&nbsp;modeledImagePoints,
                                                 java.util.List&lt;java.lang.Integer&gt;&nbsp;outlierPointList,
                                                 double[]&nbsp;parameters)
                                          throws java.lang.Exception</pre>
<div class="block">Computes the best, in a least squared error sense, set of camera parameters that transform 
 the given test pattern 3D coordinates to the corresponding 2D image points. This is very 
 similar to what OpenCv's Calib3d.calibrateCamera does except this implementation takes 
 advantage of the fact that it is known that the rotation of the camera WRT the test patterns
 is constant and that the Z height of the camera is also constant for all test patterns.
 
 The openpnp camera model that transforms 3D machine coordinates to 2D image points is:
 
      U = K * D( R * (X - T) )
      
      Where:
      U   is a 3x1 vector containing the image coordinates, in pixels, of a point (Z = 1 for 
            all points);
      K   is the 3x3 intrinsic camera matrix;
      D() is OpenCV's five parameter distortion model - takes a 3x1 vector as a parameter in 
            undistorted camera coordinates and returns a normalized 3x1 vector (Z=1) in 
            distorted camera coordinates;
      R   is a 3x3 rotation matrix that transforms vectors from the machine reference frame to
            the camera reference frame;
      X   is a 3x1 vector containing the machine coordinates of the same point as in U; and
      T   is a 3x1 vector containing the machine coordinates of the camera

      Note that this is very similar as to how OpenCV models a camera except that here T is
      in the machine reference frame rather than in the camera's reference frame.  This is so
      that we can treat the Z component of T as a single constant (since we know the camera
      is not changing in Z during the calibration process).
      
      The objective of the calibration process to use a set of known U's and X's to solve
      for the unknown K, D(), R, and T (see the description of parameters below)</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>testPattern3dPoints</code> - - a numberOfTestPatterns x numberOfPointsPerTestPattern x 3 array
        containing the 3D machine coordinates at which the corresponding point in
        testPatternImagePoints was collected.</dd>
<dd><code>testPatternImagePoints</code> - - a numberOfTestPatterns x numberOfPointsPerTestPattern x 2
        array containing the 2D image coordinates of the corresponding point in
        testPattern3dPoints.</dd>
<dd><code>modeledImagePoints</code> - - a numberOfTestPatterns x numberOfPointsPerTestPattern x 2 array
        that, upon return of this method, will contain the 2D modeled image coordinates of the
        corresponding points in testPattern3dPoints.</dd>
<dd><code>outlierPointList</code> - - an output list of indices to points that were excluded from the
        parameter estimation due to being possible outliers.</dd>
<dd><code>parameters</code> - - a 13+2*numberOfTestPatterns element array containing the camera
        parameters to be estimated in the following order: fx, fy, cx, cy, k1, k2, p1, p2, k3,
        Rx, Ry, Rz, cam_z, cam_x[0], cam_y[0], ... cam_x[numberOfTestPatterns-1],
        cam_y[numberOfTestPatterns-1]. Where fx, fy, cx, and cy are the intrinsic camera
        matrix components; k1, k2, p1, p2, and k3 are the intrinsic camera lens distortion
        coefficients; Rx, Ry, and Rz are the extrinsic camera rotation vector components;
        cam_z is the camera Z machine coordinate; and cam_x[0], cam_y[0], ...
        cam_x[numberOfTestPatterns-1], and cam_y[numberOfTestPatterns-1] are the camera X/Y
        machine coordinates for each test pattern. This array needs to be initialized with
        approximately correct values prior to calling this method and upon return of this
        method will contain the best fit camera parameters.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the DRMS error in pixels of the model's fit to the data points.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
<a name="computeBestCameraParameters-double:A:A:A-double:A:A:A-double:A:A:A-java.util.List-double:A-int-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeBestCameraParameters</h4>
<pre>public static&nbsp;double&nbsp;computeBestCameraParameters(double[][][]&nbsp;testPattern3dPoints,
                                                 double[][][]&nbsp;testPatternImagePoints,
                                                 double[][][]&nbsp;modeledImagePoints,
                                                 java.util.List&lt;java.lang.Integer&gt;&nbsp;outlierPointList,
                                                 double[]&nbsp;parameters,
                                                 int&nbsp;flags)
                                          throws java.lang.Exception</pre>
<div class="block">Computes the best, in a least squared error sense, set of camera parameters that transform 
 the given test pattern 3D coordinates to the corresponding 2D image points. This is very 
 similar to what OpenCv's Calib3d.calibrateCamera does except this implementation takes 
 advantage of the fact that it is known that the rotation of the camera WRT the test patterns
 is constant and that the Z height of the camera is also constant for all test patterns.
 
 The openpnp camera model that transforms 3D machine coordinates to 2D image points is:
 
      U = K * D( R * (X - T) )
      
      Where:
      U   is a 3x1 vector containing the image coordinates, in pixels, of a point (Z = 1 for 
            all points);
      K   is the 3x3 intrinsic camera matrix;
      D() is OpenCV's five parameter distortion model - takes a 3x1 vector as a parameter in 
            undistorted camera coordinates and returns a normalized 3x1 vector (Z=1) in 
            distorted camera coordinates;
      R   is a 3x3 rotation matrix that transforms vectors from the machine reference frame to
            the camera reference frame;
      X   is a 3x1 vector containing the machine coordinates of the same point as in U; and
      T   is a 3x1 vector containing the machine coordinates of the camera

      Note that this is very similar as to how OpenCV models a camera except that here T is
      in the machine reference frame rather than in the camera's reference frame.  This is so
      that we can treat the Z component of T as a single constant (since we know the camera
      is not changing in Z during the calibration process).
      
      The objective of the calibration process to use a set of known U's and X's to solve
      for the unknown K, D(), R, and T (see the description of parameters below)</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>testPattern3dPoints</code> - - a numberOfTestPatterns x numberOfPointsPerTestPattern x 3 array
        containing the 3D machine coordinates at which the corresponding point in
        testPatternImagePoints was collected.</dd>
<dd><code>testPatternImagePoints</code> - - a numberOfTestPatterns x numberOfPointsPerTestPattern x 2
        array containing the 2D image coordinates of the corresponding point in
        testPattern3dPoints.</dd>
<dd><code>modeledImagePoints</code> - - a numberOfTestPatterns x numberOfPointsPerTestPattern x 2 array
        that, upon return of this method, will contain the 2D modeled image coordinates of the
        corresponding points in testPattern3dPoints.</dd>
<dd><code>outlierPointList</code> - - an output list of indices to points that were excluded from the
        parameter estimation due to being possible outliers.</dd>
<dd><code>parameters</code> - - a 13+2*numberOfTestPatterns element array containing the camera
        parameters to be estimated in the following order: fx, fy, cx, cy, k1, k2, p1, p2, k3,
        Rx, Ry, Rz, cam_z, cam_x[0], cam_y[0], ... cam_x[numberOfTestPatterns-1],
        cam_y[numberOfTestPatterns-1]. Where fx, fy, cx, and cy are the intrinsic camera
        matrix components; k1, k2, p1, p2, and k3 are the intrinsic camera lens distortion
        coefficients; Rx, Ry, and Rz are the extrinsic camera rotation vector components;
        cam_z is the camera Z machine coordinate; and cam_x[0], cam_y[0], ...
        cam_x[numberOfTestPatterns-1], and cam_y[numberOfTestPatterns-1] are the camera X/Y
        machine coordinates for each test pattern. This array needs to be initialized with
        approximately correct values prior to calling this method and upon return of this
        method will contain the best fit camera parameters.</dd>
<dd><code>flags</code> - - Flags used to force certain parameters be retained from the initial starting
        values. Can be one or more of the follow added together: FIX_ASPECT_RATIO,
        FIX_CENTER_POINT, FIX_DISTORTION_COEFFICENTS, and FIX_ROTATION.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the DRMS error in pixels of the model's fit to the data points.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code></dd>
</dl>
</li>
</ul>
<a name="computeRectificationMatrix-Mat-Mat-Mat-Mat-double-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeRectificationMatrix</h4>
<pre>public static&nbsp;Mat&nbsp;computeRectificationMatrix(Mat&nbsp;transformFromMachToPhyCamRefFrame,
                                             Mat&nbsp;vectorFromMachToPhyCamInMachRefFrame,
                                             Mat&nbsp;transformFromMachToVirCamRefFrame,
                                             Mat&nbsp;vectorFromMachToVirCamInMachRefFrame,
                                             double&nbsp;primaryZ)</pre>
<div class="block">Computes the rectification matrix that converts normalized physical camera coordinates to the
 virtual camera coordinates</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>transformFromMachToPhyCamRefFrame</code> - - the 3x3 rotation matrix that converts vector
        components from the machine coordinate system to the physical camera coordinate system</dd>
<dd><code>vectorFromMachToPhyCamInMachRefFrame</code> - - the 3x1 vector from the machine origin to the
        physical camera origin with components represented in the machine coordinate system</dd>
<dd><code>transformFromMachToVirCamRefFrame</code> - - the 3x3 rotation matrix that converts vector
        components from the machine coordinate system to the virtual camera coordinate system</dd>
<dd><code>vectorFromMachToVirCamInMachRefFrame</code> - - the 3x1 vector from the machine origin to the
        virtual camera origin with components represented in the machine coordinate system</dd>
<dd><code>primaryZ</code> - - the machine Z coordinate, in millimeters, that is used as the default
        imaging height</dd>
<dt><span class="returnLabel">Returns:</span></dt>
</dl>
</li>
</ul>
<a name="computeVirtualCameraMatrix-Mat-Mat-Mat-Size-Size-double-boolean-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeVirtualCameraMatrix</h4>
<pre>public static&nbsp;Mat&nbsp;computeVirtualCameraMatrix(Mat&nbsp;physicalCameraMatrix,
                                             Mat&nbsp;distortionCoefficients,
                                             Mat&nbsp;rectification,
                                             Size&nbsp;phyCamSize,
                                             Size&nbsp;virCamSize,
                                             double&nbsp;alpha,
                                             boolean&nbsp;keepPrincipalPoint)</pre>
<div class="block">Computes the virtual camera matrix. This is similar to openCV's getOptimalNewCameraMatrix
 except that it also takes into account any image rectification.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>physicalCameraMatrix</code> - - the physical camera's intrinsic matrix</dd>
<dd><code>distortionCoefficients</code> - - the physical camera's lens distortion coefficients</dd>
<dd><code>rectification</code> - - the rectification matrix that takes the physical camera points to the
        virtual camera points</dd>
<dd><code>size</code> - - the physical camera's image size</dd>
<dd><code>alpha</code> - - a free scaling parameter in the range 0 to 1 inclusive. A value of a zero
        ensures only valid image pixels are displayed but may result in the loss of some valid
        pixels around the edge of the image. A value of one ensure all valid pixels are
        displayed but that may result in some invalid (usually black) pixels being displayed
        around the edge of the image.</dd>
<dd><code>keepPrincipalPoint</code> - - if set true, the virtual camera's principal point is set to match
        that of the physical camera's principal point</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the virtual camera's intrinsic camera matrix</dd>
</dl>
</li>
</ul>
<a name="computeVirtualCameraMatrix-Mat-Mat-Mat-Size-Size-double-Mat-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeVirtualCameraMatrix</h4>
<pre>public static&nbsp;Mat&nbsp;computeVirtualCameraMatrix(Mat&nbsp;physicalCameraMatrix,
                                             Mat&nbsp;distortionCoefficients,
                                             Mat&nbsp;rectification,
                                             Size&nbsp;phyCamSize,
                                             Size&nbsp;virCamSize,
                                             double&nbsp;alpha,
                                             Mat&nbsp;principalPoint)</pre>
<div class="block">Computes the virtual camera matrix. This is similar to openCV's getOptimalNewCameraMatrix
 except that it also takes into account image rectification.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>physicalCameraMatrix</code> - - the physical camera's intrinsic matrix</dd>
<dd><code>distortionCoefficients</code> - - the physical camera's lens distortion coefficients</dd>
<dd><code>rectification</code> - - the rectification matrix that takes the physical camera points to the
        virtual camera points</dd>
<dd><code>phyCamSize</code> - - the physical camera's image size</dd>
<dd><code>virCamSize</code> - - (output) the virtual camera's image size</dd>
<dd><code>alpha</code> - - a free scaling parameter in the range 0 to 1 inclusive. A value of a zero
        ensures only valid image pixels are displayed but may result in the loss of some valid
        pixels around the edge of the image. A value of one ensure all valid pixels are
        displayed but that may result in some invalid (usually black) pixels being displayed
        around the edge of the image.</dd>
<dd><code>principalPoint</code> - - a 3x1 matrix containing the point in physical camera coordinates of
        the desired principal point of the virtual camera, if null, the principal point will
        be computed so as to maximize the valid pixels in the resulting image</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the virtual camera's intrinsic camera matrix</dd>
</dl>
</li>
</ul>
<a name="computeResidualErrors-double:A:A:A-double:A:A:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeResidualErrors</h4>
<pre>public static&nbsp;java.util.List&lt;double[]&gt;&nbsp;computeResidualErrors(double[][][]&nbsp;actual2DPoints,
                                                             double[][][]&nbsp;modeled2DPoints)</pre>
<div class="block">Computes the 2D error between the actual image points and the modeled image points</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>actual2DPoints</code> - - the actual image points</dd>
<dd><code>modeled2DPoints</code> - - the modeled image points</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the 2D residual errors</dd>
</dl>
</li>
</ul>
<a name="computeResidualErrors-double:A:A:A-double:A:A:A-java.util.ArrayList-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeResidualErrors</h4>
<pre>public static&nbsp;java.util.List&lt;double[]&gt;&nbsp;computeResidualErrors(double[][][]&nbsp;actual2DPoints,
                                                             double[][][]&nbsp;modeled2DPoints,
                                                             java.util.ArrayList&lt;java.lang.Integer&gt;&nbsp;outlierList)</pre>
<div class="block">Computes the 2D error between the actual image points and the modeled image points</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>actual2DPoints</code> - - the actual image points</dd>
<dd><code>modeled2DPoints</code> - - the modeled image points</dd>
<dd><code>outlierList</code> - - a list of outlier points to exclude, set to null to not exclude any 
 points</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the 2D residual errors</dd>
</dl>
</li>
</ul>
<a name="computeResidualErrors-double:A:A:A-double:A:A:A-java.lang.Integer-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeResidualErrors</h4>
<pre>public static&nbsp;java.util.List&lt;double[]&gt;&nbsp;computeResidualErrors(double[][][]&nbsp;actual2DPoints,
                                                             double[][][]&nbsp;modeled2DPoints,
                                                             java.lang.Integer&nbsp;heightIndex)</pre>
<div class="block">Computes the 2D error between the actual image points and the modeled image points</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>actual2DPoints</code> - - the actual image points</dd>
<dd><code>modeled2DPoints</code> - - the modeled image points</dd>
<dd><code>heightIndex</code> - - index to select which calibration height to compute the residual 
 errors, set to null to compute over all heights</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the 2D residual errors</dd>
</dl>
</li>
</ul>
<a name="computeResidualErrors-double:A:A:A-double:A:A:A-java.lang.Integer-java.util.ArrayList-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeResidualErrors</h4>
<pre>public static&nbsp;java.util.List&lt;double[]&gt;&nbsp;computeResidualErrors(double[][][]&nbsp;actual2DPoints,
                                                             double[][][]&nbsp;modeled2DPoints,
                                                             java.lang.Integer&nbsp;heightIndex,
                                                             java.util.ArrayList&lt;java.lang.Integer&gt;&nbsp;outlierList)</pre>
<div class="block">Computes the 2D error between the actual image points and the modeled image points</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>actual2DPoints</code> - - the actual image points</dd>
<dd><code>modeled2DPoints</code> - - the modeled image points</dd>
<dd><code>heightIndex</code> - - index to select which calibration height to compute the residual 
 errors, set to null to compute over all heights</dd>
<dd><code>outlierList</code> - - a list of outlier points to exclude, set to null to not exclude any 
 points</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the 2D residual errors</dd>
</dl>
</li>
</ul>
<a name="computeDrmsError-java.util.List-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>computeDrmsError</h4>
<pre>public static&nbsp;double&nbsp;computeDrmsError(java.util.List&lt;double[]&gt;&nbsp;residuals)</pre>
<div class="block">Computes the Distance Root-Mean-Squared (DRMS) error for a given set of 2D errors</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>residuals</code> - - the errors</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the DRMS value of the errors</dd>
</dl>
</li>
</ul>
<a name="generateErrorImage-Size-int-double:A:A:A-double:A:A:A-java.util.ArrayList-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>generateErrorImage</h4>
<pre>public static&nbsp;Mat&nbsp;generateErrorImage(Size&nbsp;size,
                                     int&nbsp;testPatternIndex,
                                     double[][][]&nbsp;actual2DPoints,
                                     double[][][]&nbsp;modeled2DPoints,
                                     java.util.ArrayList&lt;java.lang.Integer&gt;&nbsp;outlierList)</pre>
<div class="block">Generates a heat map of the residual errors between the actual image points and the modeled 
 image points. The image is scaled so that darkest red indicates the areas of highest error 
 and darkest blue zero error.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>size</code> - - the image size</dd>
<dd><code>testPatternIndex</code> - - selects which calibration height for which the image is generated</dd>
<dd><code>actual2DPoints</code> - - the actual 2D image points</dd>
<dd><code>modeled2DPoints</code> - - the modeled 2D image points</dd>
<dd><code>outlierList</code> - - a list of outlier points to exclude from the image, set to null to not
 exclude any points</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the heat map of errors</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/AdvancedCalibration.html" title="class in org.openpnp.machine.reference.camera.calibration"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../../../org/openpnp/machine/reference/camera/calibration/LensCalibrationParams.html" title="class in org.openpnp.machine.reference.camera.calibration"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?org/openpnp/machine/reference/camera/calibration/CameraCalibrationUtils.html" target="_top">Frames</a></li>
<li><a href="CameraCalibrationUtils.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
